spring:
  application:
    name: data-migration-batch

  # データソース設定
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5434/newdb}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: ${DB_POOL_SIZE:10}
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # JPA設定
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          batch_size: 50  # バッチINSERT最適化

  # Spring Batch設定
  batch:
    jdbc:
      initialize-schema: always
    job:
      enabled: false  # GUI/REST APIから手動実行するため自動実行を無効化

# バッチ処理固有の設定
batch:
  # チャンクサイズ
  chunk-size: ${BATCH_CHUNK_SIZE:100}
  # スキップ上限
  skip-limit: ${BATCH_SKIP_LIMIT:10}
  # 入力ファイルパス
  input:
    customer-file: ${CUSTOMER_FILE:classpath:data/old_customers.tsv}
    company-file: ${COMPANY_FILE:classpath:data/old_companies.tsv}
  # レポート出力設定
  report:
    output-dir: ${BATCH_REPORT_DIR:./reports}
  # データマスク設定（テスト環境用）
  masking:
    enabled: ${BATCH_MASKING_ENABLED:false}  # 本番はfalse、テストはtrue
    mask-email: true
    mask-phone: true
    mask-address: true
    mask-postal-code: true

# ロギング設定
logging:
  # 注意: ファイル出力設定(file/pattern)は logback-spring.xml に移動しました
  level:
    com.example.batch: DEBUG
    org.springframework.batch: INFO
    org.hibernate.SQL: DEBUG
# Spring Boot Actuator設定
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,batch
      base-path: /actuator
  endpoint:
    health:
      show-details: always
    metrics:
      enabled: true
  info:
    env:
      enabled: true

# アプリケーション情報
info:
  app:
    name: Data Migration Batch Application
    description: Spring Batch application for data migration from TSV to PostgreSQL
    version: 1.0.0
